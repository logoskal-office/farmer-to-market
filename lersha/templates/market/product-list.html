{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="min-h-screen bg-bg-primary">
<header class="bg-gray-100 mb-4">
        {% include 'navbar.html' %}
</header>

<main class="max-w-8xl mx-auto lg:mx-16 px-4 py-8">
    <!-- Page Header -->
    <!-- Filters & Search Bar -->
    <div class="mb-8 flex flex-col md:flex-row gap-4 items-center justify-between">
        <div class="w-full md:w-96">
            <input
                id="search"
                type="text"
                placeholder="Search products..."
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>

        <div class="flex flex-wrap gap-4 items-center">
            <!-- Category -->
            <select
                id="category"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category }}</option>
                {% endfor %}
            </select>

            <!-- Min Price -->
            <input
                type="number"
                id="price_min"
                min="0"
                placeholder="Min price"
                class="w-28 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">

            <!-- Max Price -->
            <input
                type="number"
                id="price_max"
                min="0"
                placeholder="Max price"
                class="w-28 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>
    </div>

    <script>
        const searchInput = document.getElementById("search");
        const categorySelect = document.getElementById("category");
        const priceMinInput = document.getElementById("price_min");
        const priceMaxInput = document.getElementById("price_max");

        // Read URL params
        const urlParams = new URLSearchParams(window.location.search);

        // 1Ô∏è‚É£ Preselect values from URL
        if (urlParams.get("search")) {
            searchInput.value = urlParams.get("search");
        }
        if (urlParams.get("category")) {
            categorySelect.value = urlParams.get("category");
        }

        if (urlParams.get("price_min")) {
            priceMinInput.value = urlParams.get("price_min");
        }

        if (urlParams.get("price_max")) {
            priceMaxInput.value = urlParams.get("price_max");
        }

        // 2Ô∏è‚É£ Helper to update URL and reload
        function updateURLParam(key, value) {
            const url = new URL(window.location.href);

            if (value) {
                url.searchParams.set(key, value);
            } else {
                url.searchParams.delete(key);
            }

            // üî• reset pagination when filters change
            url.searchParams.delete("page");

            window.location.href = url.toString();
        }

        searchInput.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                updateURLParam("search", this.value.trim());
            }
        });
        // 3Ô∏è‚É£ Category change
        categorySelect.addEventListener("change", function () {
            updateURLParam("category", this.value);
        });

        // 4Ô∏è‚É£ Price changes (on blur or Enter)
        priceMinInput.addEventListener("change", function () {
            updateURLParam("price_min", this.value);
        });

        priceMaxInput.addEventListener("change", function () {
            updateURLParam("price_max", this.value);
        });
    </script>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 items-stretch">
        <!-- Product Card 1 -->
            {% for product in products %}
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden hover:shadow-xl transition duration-300">
            <a href="{% url 'product-detail-page' product.id %}">
            <div class="relative">
                <img src="{{product.image.url}}" alt="Fresh Tomatoes" class="w-full h-56 object-cover">
                <span class="absolute top-2 right-2 bg-green-600 text-white px-3 py-1 rounded-full text-sm font-semibold">Organic</span>
            </div>
                <div class="p-5">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">{{product.name}}</h3>
                    <p class="text-gray-600 mb-3">{{product.description|truncatechars:50}}</p>
                    <div class="flex flex-col justify-between items-start gap-4 ">
                        <span class="text-xl font-bold text-green-700">${{product.price|intcomma}}/{{product.quantity_unit}}</span>
                        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300 flex items-center gap-2 grow-0">
                            <i class="fas fa-cart-plus"></i> Add
                        </button>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}

        <!-- Product Card 2 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
            <div class="relative">
                <img src="https://images.unsplash.com/photo-1567206563060-55a9af775220?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Carrots" class="w-full h-56 object-cover">
            </div>
            <div class="p-5">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Rainbow Carrots</h3>
                <p class="text-gray-600 mb-3">Sweet and colorful bunch from Sunny Acres</p>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-green-700">$3.49/bunch</span>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300 flex items-center gap-2">
                        <i class="fas fa-cart-plus"></i> Add
                    </button>
                </div>
            </div>
        </div>

        <!-- Repeat similar cards for more products -->
        <!-- Product Card 3 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
            <div class="relative">
                <img src="https://images.unsplash.com/photo-1586201375761-8385cb5529d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Honey" class="w-full h-56 object-cover">
                <span class="absolute top-2 right-2 bg-yellow-500 text-white px-3 py-1 rounded-full text-sm font-semibold">Local</span>
            </div>
            <div class="p-5">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Raw Wildflower Honey</h3>
                <p class="text-gray-600 mb-3">Pure honey from local beehives</p>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-green-700">$12.99/jar</span>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300 flex items-center gap-2">
                        <i class="fas fa-cart-plus"></i> Add
                    </button>
                </div>
            </div>
        </div>

        <!-- Product Card 4 -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300">
            <div class="relative">
                <img src="https://images.unsplash.com/photo-1550583724-b2692b85b150?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" alt="Apples" class="w-full h-56 object-cover">
            </div>
            <div class="p-5">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Honeycrisp Apples</h3>
                <p class="text-gray-600 mb-3">Crisp and juicy, picked this week</p>
                <div class="flex justify-between items-center">
                    <span class="text-2xl font-bold text-green-700">$5.99/lb</span>
                    <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-300 flex items-center gap-2">
                        <i class="fas fa-cart-plus"></i> Add
                    </button>
                </div>
            </div>
        </div>
        <!-- Add more product cards as needed -->
    </div>

</main>

<!-- Pagination (optional) -->
{% if products.paginator.num_pages > 1 %}
    <div class="mt-10 flex justify-center gap-2">

        {% if products.has_previous %}
            <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ products.previous_page_number }}"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                Prev
            </a>
        {% endif %}

        {% for num in products.paginator.page_range %}
            {% if num == products.number %}
                <span class="px-4 py-2 rounded-lg bg-green-600 text-white font-semibold">
                    {{ num }}
                </span>
            {% else %}
                <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                    {{ num }}
                </a>
            {% endif %}
        {% endfor %}

        {% if products.has_next %}
            <a href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ products.next_page_number }}"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                Next
            </a>
        {% endif %}

    </div>
{% endif %}
    <!-- Mobile menu toggle script -->
<script>
    document.getElementById('mobile-menu-button').addEventListener('click', () => {
        document.getElementById('mobile-menu').classList.toggle('hidden');
    });
</script>
<script>
    let currentUrl = window.location.href
    let url = new URL(window.location.href)
    let params = new URLSearchParams(window.location.search)
    const page = params.get('order')
    // alert(page)
</script>

</body>
</html>
